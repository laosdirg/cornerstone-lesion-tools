/*! cornerstone-lesion-tools - 0.1.0 - 2018-03-12 | (c) 2017 Chris Hafey | undefined */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("cornerstoneLesionTools",[],t):"object"==typeof exports?exports.cornerstoneLesionTools=t():e.cornerstoneLesionTools=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=4)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=window.cornerstoneTools;t.default={set cornerstoneTools(e){n=e},get cornerstoneTools(){return n},get cornerstone(){return n.external.cornerstone},get cornerstoneMath(){return n.external.cornerstoneMath}}},function(e,t,r){"use strict";function n(){return a}function o(e){console.log("c",e),a=e}Object.defineProperty(t,"__esModule",{value:!0}),t.getConfiguration=n,t.setConfiguration=o;var a={snap:!1,historySize:4,layersAbove:1,layersBelow:1,historyPosition:0,toolRegionValue:2,calciumThresholdHu:"-",drawAlpha:1,regionColorsRGB:[[255,0,255],[246,193,91],[237,148,69],[230,103,49],[184,74,41],[106,58,45]],KVPToMultiplier:{150:1.06,140:1.04,130:1.02,120:1,110:.98,100:.96,90:.93,80:.89,70:.85},growIterationsPerChunk:2};a.calciumThresholdHuParsed=parseInt(a.calciumThresholdHu,10)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TYPED_ARRAY=Uint8Array,t.TOOL_TYPE="regions"},function(e,t,r){"use strict";function n(e){var t=c(e,"regions"),r=t.data[0],n=r.buffer.slice();r.history.push(n),r.history.length>(0,l.getConfiguration)().historySize&&r.history.shift()}function o(e){var t=c(e,"regions"),r=t.data[0];if(!(r.history.length<1)){var n=r.history.pop();r.buffer=n,u.default.cornerstone.updateImage(e)}}function a(){}Object.defineProperty(t,"__esModule",{value:!0}),t.createUndoStep=n,t.undo=o,t.redo=a;var i=r(0),u=function(e){return e&&e.__esModule?e:{default:e}}(i),l=r(1),c=u.default.cornerstoneTools.getToolState},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(0);Object.defineProperty(t,"external",{enumerable:!0,get:function(){return n(o).default}});var a=r(1);Object.defineProperty(t,"getConfiguration",{enumerable:!0,get:function(){return a.getConfiguration}}),Object.defineProperty(t,"setConfiguration",{enumerable:!0,get:function(){return a.setConfiguration}});var i=r(5);Object.defineProperty(t,"display",{enumerable:!0,get:function(){return n(i).default}});var u=r(6);Object.defineProperty(t,"threshold",{enumerable:!0,get:function(){return n(u).default}});var l=r(7);Object.defineProperty(t,"grow",{enumerable:!0,get:function(){return n(l).default}});var c=r(8);Object.defineProperty(t,"draw",{enumerable:!0,get:function(){return n(c).default}});var s=r(10);Object.defineProperty(t,"score",{enumerable:!0,get:function(){return n(s).default}});var f=r(3);Object.defineProperty(t,"undo",{enumerable:!0,get:function(){return f.undo}}),Object.defineProperty(t,"redo",{enumerable:!0,get:function(){return f.redo}})},function(e,t,r){"use strict";function n(e){var t=e.detail,r=(0,u.getConfiguration)(),n=t.canvasContext,o=t.element,l=t.enabledElement,c=t.image,f=c.width,d=c.height,p=s(o,"stack"),g=s(o,"regions");if(g&&g.data&&g.data.length){if(!g.data[0].drawBuffer||f!==g.data[0].drawBuffer.canvas.width){var h=document.createElement("canvas"),v=h.getContext("2d"),m=v.createImageData(f,d);h.width=f,h.height=d,g.data[0].drawBuffer={canvas:h,imageData:m}}for(var y=p.data[0].currentImageIdIndex,b=g.data[0],w=b.drawBuffer,P=b.buffer,T=w.canvas,x=w.imageData,O=x.data,_=f*d,M=y*_,j=new i.TYPED_ARRAY(P,M,_),S=0;S<j.length;S+=1){var A=4*S,E=j[S];if(E){var I=r.regionColorsRGB[E-1];O[A+0]=I[0],O[A+1]=I[1],O[A+2]=I[2],O[A+3]=255*r.drawAlpha}else O[A+3]=0}T.getContext("2d").putImageData(x,0,0),a.default.cornerstone.setToPixelCoordinateSystem(l,n),n.drawImage(T,0,0)}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=function(e){return e&&e.__esModule?e:{default:e}}(o),i=r(2),u=r(1),l=a.default.cornerstoneTools,c=l.displayTool,s=l.getToolState,f=c(n);t.default=f},function(e,t,r){"use strict";function n(e){var t=void 0,r=void 0,n=void 0,o=void 0,a=(0,c.getConfiguration)();return Promise.all(e.map(function(i,c){return u.default.cornerstone.loadImage(i).then(function(i){if(!o){t=i.width,r=i.height;var u=t*r*e.length;o=new ArrayBuffer(u),n=new l.TYPED_ARRAY(o)}for(var s=i.intercept,f=i.slope,d=i.getPixelData(),p=t*r,g=0;g<p;g++){var h=d[g],v=h*f+s,m=v>=a.calciumThresholdHu?1:0;n[c*p+g]=m}})})).then(function(){return{buffer:o,width:t,height:r}})}function o(e){var t=void 0,r=d(e,l.TOOL_TYPE);return r&&r.data&&r.data.length?t=r.data[0]:(t={enabled:1,buffer:null,width:null,height:null,history:[],drawBuffer:null},f(e,l.TOOL_TYPE,t)),t}function a(e){var t=d(e,"stack");if(t&&t.data&&t.data.length){var r=t.data[0],a=o(e);n(r.imageIds).then(function(t){a.buffer=t.buffer,a.width=t.width,a.height=t.height,u.default.cornerstone.updateImage(e)})}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),u=function(e){return e&&e.__esModule?e:{default:e}}(i),l=r(2),c=r(1),s=u.default.cornerstoneTools,f=s.addToolState,d=s.getToolState;t.default=a},function(e,t,r){"use strict";function n(e,t,r,n,o){var a=e*t,i=[o-1,o+1,o-e,o+e],u=Math.floor(o/a);return u<r&&i.push(o+a),u>n&&i.push(o-a),i}function o(e,t){var r=(0,s.getConfiguration)(),o=r.growIterationsPerChunk,a=r.toolRegionValue,u=r.layersAbove,l=r.layersBelow,c=e.width,f=e.height,d=e.buffer,p=i(t,3),g=p[0],h=p[1],v=p[2],m=v+l,y=v-u,b=new Uint8Array(d),w=c*f,P=w*v,T=h*c+g,x=P+T,O=b[x];if(0===O||O===a)return Promise.resolve();var _=[x];return new Promise(function(e){function t(){for(var r=0;r<o;r++){if(0===_.length)return e();_.forEach(function(e){b[e]=a});var i=_.map(function(e){return n(c,f,m,y,e)}).reduce(function(e,t){return e.concat(t)},[]).filter(function(e,t,r){return r.indexOf(e)===t}).filter(function(e){return b[e]===O});_=i}setTimeout(t,0)}t()})}function a(e){var t=e.detail,r=t.currentPoints,n=t.element,a=t.which,u=h(v,n);if(g(a,u.mouseButtonMask)){var s=i(d(n,"stack").data,1),f=s[0],p=i(d(n,"regions").data,1),m=p[0],y=f.currentImageIdIndex,b=r.image,w=b.x,P=b.y,T=[Math.round(w),Math.round(P),y];(0,c.createUndoStep)(n),o(m,T).then(function(){l.default.cornerstone.updateImage(n)})}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&u.return&&u.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=r(0),l=function(e){return e&&e.__esModule?e:{default:e}}(u),c=r(3),s=r(1),f=l.default.cornerstoneTools,d=f.getToolState,p=f.simpleMouseButtonTool,g=f.isMouseButtonEnabled,h=f.getToolOptions,v="regionsGrow";t.default=p(a,v)},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){var t=(0,p.getConfiguration)(),r=t.snap,n=t.toolRegionValue,o=t.layersAbove,a=t.layersBelow;(0,g.createUndoStep)(e);for(var i=m(e,"stack"),u=m(e,"regions"),l=y(T,e),c=i.data[0].currentImageIdIndex,s=i.data[0].imageIds.length,f=u.data[0],h=f.buffer,v=f.width,b=f.height,w=Math.max(0,c-o),P=Math.min(s,c+a),x=v*b,O=w*x,_=new Uint8Array(h,O),M=0;M<=P-w;M+=1)for(var j=0;j<v;j+=1)for(var S=0;S<b;S+=1){var A=j+S*v+M*x,E=_[A],I=void 0;I=!r||E>0;var C={x:j,y:S};I&&(0,d.default)(C,l.points)&&(_[A]=n)}}function a(e){var t=e.detail,r=t.canvasContext,n=t.enabledElement,o=t.element,a=y(T,o),i=a.points;i.length<2||(s.default.cornerstone.setToPixelCoordinateSystem(n,r),r.fillStyle=v.getFillColor(),r.strokeStyle=v.getActiveColor(),r.beginPath(),r.moveTo(i[0].x,i[0].y),i.slice(1).forEach(function(e){r.lineTo(e.x,e.y)}),r.closePath(),r.stroke(),r.fill())}function i(e){var t=e.detail,r=t.currentPoints,n=t.element;y(T,n).points.push(r.image),s.default.cornerstone.updateImage(n),e.preventDefault(),e.stopPropagation()}function u(e){var t=e.detail.element;t.removeEventListener("cornerstonetoolsmousedrag",i),t.removeEventListener("cornerstonetoolsmouseup",u),t.removeEventListener("cornerstonetoolsmouseclick",u),t.removeEventListener("cornerstoneimagerendered",a),o(t),s.default.cornerstone.updateImage(t)}function l(e){var t=e.detail,r=t.element,n=t.which,o=y(T,r);P(n,o.mouseButtonMask)&&(o.points=[],b(T,r,o),r.addEventListener("cornerstonetoolsmousedrag",i),r.addEventListener("cornerstonetoolsmouseup",u),r.addEventListener("cornerstonetoolsmouseclick",u),r.addEventListener("cornerstoneimagerendered",a),e.preventDefault(),e.stopPropagation())}Object.defineProperty(t,"__esModule",{value:!0});var c=r(0),s=n(c),f=r(9),d=n(f),p=r(1),g=r(3),h=s.default.cornerstoneTools,v=h.toolColors,m=h.getToolState,y=h.getToolOptions,b=h.setToolOptions,w=h.simpleMouseButtonTool,P=h.isMouseButtonEnabled,T="draw";t.default=w(l,T)},function(e,t,r){"use strict";function n(e,t){for(var r=e.x,n=e.y,o=t.length,a=!1,i=0,u=o-1;i<o;u=i++){var l=t[i],c=l.x,s=l.y,f=t[u],d=f.x,p=f.y;s>n!=p>n&&r<(d-c)*(n-s)/(p-s)+c&&(a=!a)}return a}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t,r){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function o(e){return e<130?0:e<200?1:e<300?2:e<400?3:4}function a(e){if(0===e.length)return null;for(var t={},r=e[0],n=1,o=0;o<e.length;o++){var a=e[o];null===t[a]?t[a]=1:t[a]++,t[a]>n&&(r=a,n=t[a])}return r}function i(e){if(0===e.sliceThickness||0===e.pixelSpacing[0]||0===e.pixelSpacing[1])throw new Error("sliceThickness or pixelSpacing was 0");return e.sliceThickness*e.pixelSpacing[0]*e.pixelSpacing[1]}function u(e,t){var r=i(e)/3,n=o(e.maxHU),a=t.length*r,u=(0,h.getConfiguration)(),l=u.KVPToMultiplier,c=l[e.KVP],s=a*n*c;return e.modeOverlapFactor?s*e.modeOverlapFactor:s}function l(e,t){var r=new g.default.cornerstoneMath.Vector3;r.fromArray(e[0]);var n=new g.default.cornerstoneMath.Vector3;n.fromArray(e[1]);var o=new g.default.cornerstoneMath.Vector3;o.fromArray(t[0]);var a=new g.default.cornerstoneMath.Vector3;a.fromArray(t[1]);var i=new g.default.cornerstoneMath.Vector3;i.crossVectors(o,a);var u=r.projectOnVector(i),l=n.projectOnVector(i);return u.distanceTo(l)}function c(e,t){if(e<=0)throw new Error("Distance must be > 0");return e>=t?1:(t-(t-e))/t}function s(e,t,r,n,o,a){for(var i=a.intercept,u=a.slope,l=a.width,c=a.getPixelData(),s=[],f=[[e,t]];f.length>0;){var p=f.shift(),g=d(p,2),h=g[0],v=g[1];if(0===n[h][v]&&r[v*l+h]===o){f.push([h-1,v]),f.push([h+1,v]),f.push([h,v-1]),f.push([h,v+1]);var m=c[h+v*l],y=m*u+i;y>=130&&s.push(y),n[h][v]=1}}return s}function f(e){var t=(0,h.getConfiguration)(),r=t.regionColorsRGB,o=m(e,v.TOOL_TYPE),i=m(e,"stack"),f=o.data[0].buffer,d=i.data[0].imageIds,p=r.slice(1).map(function(){return d.map(function(){return[]})}),y=r.slice(1).map(function(){return d.map(function(){return[]})}),b=void 0,w=void 0,P=[],T={};return Promise.all(d.map(function(e,t){return g.default.cornerstone.loadImage(e).then(function(e){var r=e.data;T.sliceThickness=r.floatString("x00180050"),T.pixelSpacing=r.string("x00280030").split("\\").map(parseFloat),T.KVP=r.floatString("x00180060"),T.rescaleSlope=r.floatString("x00281053"),T.rescaleIntercept=r.floatString("x00281052"),T.rescaleType=r.string("x00281054");var o=r.string("x00200032").split("\\").map(parseFloat),i=r.string("x00200037").split("\\").map(parseFloat),u=[i.slice(0,3),i.slice(3)];if(w){var d=l([w,o],u);b=c(d,T.sliceThickness),P.push(b),T.modeOverlapFactor=a(P),w=o}else w=o;for(var g=e.height,h=e.width,m=h*g,x=t*m,O=new v.TYPED_ARRAY(f,x,m),_=Array(h).fill().map(function(){return Array(g).fill(0)}),M=0;M<h;M+=1)for(var j=0;j<g;j+=1){var S=O[j*h+M];if(S>1){var A=s(M,j,O,_,S,e);if(A.length){var E=Math.max.apply(Math,n(A));p[S-2][t].push(A),y[S-2][t].push(E)}}}})})).then(function(){return p.map(function(e,t){var r=[];return e.forEach(function(e,n){e.forEach(function(e,o){T.maxHU=y[t][n][o];var a=e.length>0?u(T,e):0;r.push(a)})}),r.reduce(function(e,t){return e+t},0)})})}Object.defineProperty(t,"__esModule",{value:!0});var d=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&u.return&&u.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.computeVoxelSize=i,t.computeScore=u,t.computeIOPProjectedDistance=l,t.computeOverlapFactor=c,t.score=f;var p=r(0),g=function(e){return e&&e.__esModule?e:{default:e}}(p),h=r(1),v=r(2),m=g.default.cornerstoneTools.getToolState;t.default=f}])});
//# sourceMappingURL=cornerstoneLesionTools.min.js.map